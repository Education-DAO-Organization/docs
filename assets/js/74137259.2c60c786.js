"use strict";(self.webpackChunkeducation_docs=self.webpackChunkeducation_docs||[]).push([[8727],{2781:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var n=o(4848),a=o(8453);const s={},i="Ethereum Provider API",r={id:"courses/blockchain-developer-bootcamp/S04-developer-tooling/M7-web3-frontend/L1-ethereum-provider-api/index",title:"Ethereum Provider API",description:"Now that you have your smart contract fundamentals down, how about frontend alpha?",source:"@site/docs/courses/blockchain-developer-bootcamp/S04-developer-tooling/M7-web3-frontend/L1-ethereum-provider-api/index.md",sourceDirName:"courses/blockchain-developer-bootcamp/S04-developer-tooling/M7-web3-frontend/L1-ethereum-provider-api",slug:"/courses/blockchain-developer-bootcamp/S04-developer-tooling/M7-web3-frontend/L1-ethereum-provider-api/",permalink:"/educationdao.xyz/docs/courses/blockchain-developer-bootcamp/S04-developer-tooling/M7-web3-frontend/L1-ethereum-provider-api/",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"oliver renwick",lastUpdatedAt:1721055769e3,frontMatter:{},sidebar:"docSidebar",previous:{title:"Title",permalink:"/educationdao.xyz/docs/courses/blockchain-developer-bootcamp/S04-developer-tooling/M6-exercise/"},next:{title:"A Demystification of \u201cConnect Wallet\u201d",permalink:"/educationdao.xyz/docs/courses/blockchain-developer-bootcamp/S04-developer-tooling/M7-web3-frontend/L2-demystifying-connect-wallet/"}},c={},d=[{value:"Where does this API come from?",id:"where-does-this-api-come-from",level:2},{value:"Additional Reading",id:"additional-reading",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"ethereum-provider-api",children:"Ethereum Provider API"}),"\n",(0,n.jsx)(t.p,{children:"Now that you have your smart contract fundamentals down, how about frontend alpha?"}),"\n",(0,n.jsx)(t.p,{children:"The privileges enabled by Web3 are both some of the most promising and challenging in the web development landscape. The ability of users to use digital signatures to validate identity, submit transactions validated without a central authority and interact with a public-state database are extraordinary achievements. But, they also are radically different from the way many users experience the internet."}),"\n",(0,n.jsxs)(t.p,{children:["If you go to any dApp frontend, it knows immediately that you may not have a browser wallet, so it onboards you to one. If it\u2019s your first time using that dApp, it knows you haven\u2019t granted the dApp permission to access your wallet, it prompts you to \u201cConnect\u201d. If you\u2019ve used that dApp before, it knows who you are and shows your address, along with your balances or your NFTs. The reason why your user has access to this sort of functionality, and will, later on, be able to make contract calls, sign messages, and approve transactions is that your dApp will have access to an API called the ",(0,n.jsx)(t.a,{href:"https://docs.metamask.io/guide/ethereum-provider.html#ethereum-provider-api",children:"Ethereum Provider API"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["If you\u2019ve built a CRUD app with a REST API for a backend, then you had to define a function to make that API call, then supply ",(0,n.jsx)(t.code,{children:"fetch"})," with an endpoint, and then based on the action you intend for your user to take, your function would use a particular ",(0,n.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods",children:"HTTP method"}),". If your CRUD app was just pulling in data from an API, you\u2019d also have to supply that endpoint to fetch from."]}),"\n",(0,n.jsx)(t.p,{children:"In Web3, this is less common. While we can interact with third party services, most of our data is stored on the Ethereum Blockchain. We\u2019re not referencing our database with our version of on-chain events, we need the Ethereum blockchain. We need the version of events from the nodes with the longest chain because a blockchain is essentially one massive database."}),"\n",(0,n.jsx)(t.h2,{id:"where-does-this-api-come-from",children:"Where does this API come from?"}),"\n",(0,n.jsxs)(t.p,{children:["On a browser where you have MetaMask installed, open up Chrome Devtools, navigate to ",(0,n.jsx)(t.strong,{children:"Sources"}),", and then look at the ",(0,n.jsx)(t.strong,{children:"Page"})," panel. If you expand MetaMask, there\u2019s a resource that loads with the page, in the screenshot, it\u2019s ",(0,n.jsx)(t.code,{children:"inpage.js"}),"."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Chrome Devtools showing ",src:o(2730).A+"",width:"1189",height:"707"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"[inpage.js](https://github.com/MetaMask/metamask-extension/blob/43c33b676fe1ecece3e0543eb6ca64d3ae9aa9af/app/scripts/inpage.js)"})," is a script that tries to declare an object globally in the browser window. If it\u2019s successful, it\u2019ll create a communication stream to \ud83d\udc40\xa0initialize a provider \ud83d\udc40. Once that runs, ",(0,n.jsx)(t.code,{children:"[contentscript.js](https://github.com/MetaMask/metamask-extension/blob/42c8703f3e3e0fbfddcc9faa4ddb49045ce9631a/app/scripts/contentscript.js)"})," is executed. And here\u2019s where things get tricky but interesting. On ",(0,n.jsx)(t.a,{href:"https://github.com/MetaMask/metamask-extension/blob/42c8703f3e3e0fbfddcc9faa4ddb49045ce9631a/app/scripts/contentscript.js#L45",children:"line 45"}),", there\u2019s an else-if statement that calls a function, seen on ",(0,n.jsx)(t.a,{href:"https://github.com/MetaMask/metamask-extension/blob/42c8703f3e3e0fbfddcc9faa4ddb49045ce9631a/app/scripts/contentscript.js#L272",children:"line 272"}),", to check if a provider should be \ud83d\udc40\xa0injected \ud83d\udc40."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"/**\n * Determines if the provider should be injected\n *\n * @returns {boolean} {@code true} Whether the provider should be injected\n */\nfunction shouldInjectProvider() {\n  return (\n    doctypeCheck() &&\n    suffixCheck() &&\n    documentElementCheck() &&\n    !blockedDomainCheck()\n  );\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["This function returns a boolean and checks for conditions like if the window even exists, so if the ",(0,n.jsx)(t.code,{children:"doctype"})," is HTML (",(0,n.jsx)(t.code,{children:"doctypeCheck()"}),"), and if it\u2019s an HTML node (",(0,n.jsx)(t.code,{children:"documentElementCheck()"}),"). It checks if the site URL ends in ",(0,n.jsx)(t.code,{children:".xml"})," or ",(0,n.jsx)(t.code,{children:".pdf"})," (``suffixCheck()",(0,n.jsx)(t.code,{children:"). It checks if the site you\u2019re currently on is not on a list of blocked domains ("}),"!blockedDomainCheck()`). (",(0,n.jsxs)(t.em,{children:["Check out some of those ",(0,n.jsx)(t.a,{href:"https://github.com/MetaMask/metamask-extension/blob/42c8703f3e3e0fbfddcc9faa4ddb49045ce9631a/app/scripts/contentscript.js#L332",children:"blocked domains"}),". Are some of them familiar? Are you beginning to see a pattern here?"]}),") If all conditions pass, then MetaMask knows it can act as a client to facilitate user Web 3 interactions. This is why you get a popup whenever you try to take any action."]}),"\n",(0,n.jsxs)(t.p,{children:["The thing to take away here is that we as developers aren\u2019t supplying that API endpoint, or the functionality to interact with it, and it\u2019s for the safety of the user. We\u2019re building around its expected existence, and that\u2019s because MetaMask and other browser wallets, per ",(0,n.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-1193",children:"EIP-1193"}),", globally inject a standard provider interface as a bridge to the Ethereum blockchain into our browser. The browser wallets actually do the heavy lifting by providing the API endpoint. As developers, we just have to call it with ",(0,n.jsx)(t.code,{children:"window.ethereum"}),". (",(0,n.jsx)(t.em,{children:"Provided, we\u2019re not on that blocked domain list, cause we absolutely should not be."}),")"]}),"\n",(0,n.jsxs)(t.p,{children:["When you switch to the Console tab, type in ",(0,n.jsx)(t.code,{children:"window.ethereum"})," to see the Ethereum API methods and properties like ",(0,n.jsx)(t.code,{children:"isMetaMask"}),", ",(0,n.jsx)(t.code,{children:"chainId"})," or ",(0,n.jsx)(t.code,{children:"request()"}),", to name a few."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Ethereum Provider API methods and properties",src:o(2625).A+"",width:"2060",height:"1394"})}),"\n",(0,n.jsx)(t.p,{children:"When we call these methods, we submit a \u201cRemote Procedure Call\u201d request to a particular blockchain network. We need to connect to the nodes on a particular network where the target smart contract is deployed, so we\u2019ll need a network RPC endpoint."}),"\n",(0,n.jsx)(t.p,{children:"For us, it\u2019s an endpoint we can supply to MetaMask to request blockchain data. Does that sound a bit familiar? If you look at the RPC URL I have for Ethereum Mainnet, I\u2019m connected to the Mainnet nodes that are hosted by Infura, who is the default node provider for MetaMask."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"MetaMask Network Settings",src:o(584).A+"",width:"2680",height:"1998"})}),"\n",(0,n.jsxs)(t.p,{children:["Instead, we use the ",(0,n.jsx)(t.code,{children:"request()"})," and ",(0,n.jsx)(t.code,{children:"send()"})," methods. From there, we pass in arguments to determine what we\u2019d like to request. We can use ",(0,n.jsx)(t.code,{children:"request"})," to:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Prompt our user to allow us to view their accounts and balances. Or we can"}),"\n",(0,n.jsx)(t.li,{children:"Prompt them to switch to a particular network, and if they don\u2019t have it configured, we can suggest that network."}),"\n",(0,n.jsx)(t.li,{children:"If they receive tokens that aren\u2019t on a pre-approved list of recognized tokens,"}),"\n",(0,n.jsxs)(t.li,{children:["we can suggest that their ",(0,n.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-747",children:"token can be tracked"})," to show up as an asset in their wallet."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["You can see the whole list of methods ",(0,n.jsx)(t.a,{href:"https://metamask.github.io/api-playground/api-documentation",children:"here"}),". For every single request, MetaMask will pop up asking the user to confirm the action, because the request has to go through MetaMask to the nodes."]}),"\n",(0,n.jsx)(t.p,{children:"In the next lesson we\u2019ll start off by demystifying what it means to \u201cConnect your Wallet\u201d, and how you can achieve that with React and the Ethereum Provider API."}),"\n",(0,n.jsx)(t.h2,{id:"additional-reading",children:"Additional Reading"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://docs.metamask.io/guide/ethereum-provider.html",children:"Ethereum Provider API"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://github.com/MetaMask/providers",children:"Github: MetaMask/Provider"})})]})}function l(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},2730:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/eth-provider-1-6d790d2336c9ad7ac2c25384d6923f35.png"},2625:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/eth-provider-2-e0a7902f1ae3f95c4b97b32e3b80ff77.png"},584:(e,t,o)=>{o.d(t,{A:()=>n});const n=o.p+"assets/images/eth-provider-3-7edf000b2e176f5c324c43cafbd16e05.png"},8453:(e,t,o)=>{o.d(t,{R:()=>i,x:()=>r});var n=o(6540);const a={},s=n.createContext(a);function i(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);