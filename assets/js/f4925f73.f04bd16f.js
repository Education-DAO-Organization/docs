"use strict";(self.webpackChunkeducation_docs=self.webpackChunkeducation_docs||[]).push([[5943],{8851:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>o});var r=s(4848),i=s(8453);const t={},a="Solidity Pitfalls and Attacks",l={id:"courses/blockchain-developer-bootcamp/S03-smart-contracts/M6-security/L2-solidity-pitfalls-and-attacks/index",title:"Solidity Pitfalls and Attacks",description:"As we've made clear again and again, smart contract development is potentially very dangerous. This is unlike the vast portion of web development, where environments and code can be torn down, changed, and easily deployed again. Because of this, being a smart contract developer means being acutely aware of the ways in which your code can be exploited and creating safety features to ensure against unforeseen attacks.",source:"@site/docs/courses/blockchain-developer-bootcamp/S03-smart-contracts/M6-security/L2-solidity-pitfalls-and-attacks/index.md",sourceDirName:"courses/blockchain-developer-bootcamp/S03-smart-contracts/M6-security/L2-solidity-pitfalls-and-attacks",slug:"/courses/blockchain-developer-bootcamp/S03-smart-contracts/M6-security/L2-solidity-pitfalls-and-attacks/",permalink:"/educationdao.xyz/docs/courses/blockchain-developer-bootcamp/S03-smart-contracts/M6-security/L2-solidity-pitfalls-and-attacks/",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedBy:"oliver renwick",lastUpdatedAt:1721061896e3,frontMatter:{},sidebar:"docSidebar",previous:{title:"index",permalink:"/educationdao.xyz/docs/courses/blockchain-developer-bootcamp/S03-smart-contracts/M6-security/L1-sc-best-practices/"},next:{title:"Smart Contract Pitfalls and Attacks",permalink:"/educationdao.xyz/docs/courses/blockchain-developer-bootcamp/S03-smart-contracts/M6-security/L2a-sc-pitfalls-and-attacks/"}},c={},o=[{value:"Solidity Tips",id:"solidity-tips",level:2},{value:"Use Specific Compiler Pragma",id:"use-specific-compiler-pragma",level:3},{value:"Built-In Variable Names",id:"built-in-variable-names",level:3},{value:"Proper Use of <code>require</code>, <code>assert</code> and <code>revert</code>",id:"proper-use-of-require-assert-and-revert",level:3},{value:"Use Modifiers Only for Validations",id:"use-modifiers-only-for-validations",level:3},{value:"Pull Over Push",id:"pull-over-push",level:3},{value:"Fallback Functions and Data Length",id:"fallback-functions-and-data-length",level:3},{value:"Checks-Effects-Interactions",id:"checks-effects-interactions",level:3},{value:"Proper use of <code>call</code>, <code>delegatecall</code> instead of <code>send</code>, <code>transfer</code>",id:"proper-use-of-call-delegatecall-instead-of-send-transfer",level:3},{value:"Additional Material",id:"additional-material",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"solidity-pitfalls-and-attacks",children:"Solidity Pitfalls and Attacks"}),"\n",(0,r.jsx)(n.p,{children:"As we've made clear again and again, smart contract development is potentially very dangerous. This is unlike the vast portion of web development, where environments and code can be torn down, changed, and easily deployed again. Because of this, being a smart contract developer means being acutely aware of the ways in which your code can be exploited and creating safety features to ensure against unforeseen attacks."}),"\n",(0,r.jsx)(n.p,{children:"Over the next few sections, we're going to be discussing smart contract security. We'll start by going over some common pitfalls and attacks with Solidity (as a language) and smart contracts generally. We'll then discuss testing as a means to further protect your code. Last, we'll go over some security services you can use when writing and developing smart contracts"}),"\n",(0,r.jsx)(n.h2,{id:"solidity-tips",children:"Solidity Tips"}),"\n",(0,r.jsx)(n.h3,{id:"use-specific-compiler-pragma",children:"Use Specific Compiler Pragma"}),"\n",(0,r.jsxs)(n.p,{children:["A common method is to use the ",(0,r.jsx)(n.code,{children:"^"})," to indicate the lowest compiler version that your contract will work with. However, if you have a testing suite you've built against your contract, you should not include the ",(0,r.jsx)(n.code,{children:"^"})," and just list the compiler version."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"pragma solidity ^0.4.4; // Possibly dangerous          \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"pragma solidity 0.4.4; // Better          \n"})}),"\n",(0,r.jsx)(n.h3,{id:"built-in-variable-names",children:"Built-In Variable Names"}),"\n",(0,r.jsx)(n.p,{children:"Built-in variables can be shadowed, be careful when naming your functions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"function revert() internal pure {} // Possibly dangerous        \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"function myRevert() internal pure {} // Better            \n"})}),"\n",(0,r.jsxs)(n.h3,{id:"proper-use-of-require-assert-and-revert",children:["Proper Use of ",(0,r.jsx)(n.code,{children:"require"}),", ",(0,r.jsx)(n.code,{children:"assert"})," and ",(0,r.jsx)(n.code,{children:"revert"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"require(msg.sender == owner)"})})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Validation of ",(0,r.jsx)(n.strong,{children:"inputs, external call returns and variables"})," before state changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Refunds"})," remaining gas when fail"]}),"\n",(0,r.jsxs)(n.li,{children:["Should be used ",(0,r.jsx)(n.strong,{children:"more often"})," and ",(0,r.jsx)(n.strong,{children:"towards the beginning"})," of functions"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"assert(age > 100)"})})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Validation of ",(0,r.jsx)(n.strong,{children:"invariants"}),", situations that ",(0,r.jsx)(n.strong,{children:"should never happen"})," and variables ",(0,r.jsx)(n.strong,{children:"after state changes"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consumes all gas"})," when fail"]}),"\n",(0,r.jsxs)(n.li,{children:["Should be used ",(0,r.jsx)(n.strong,{children:"less often"})," and ",(0,r.jsx)(n.strong,{children:"towards the end"})," of functions"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"revert()"})})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reverts"})," the current transaction"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Refunds"})," remaining gas when fail"]}),"\n",(0,r.jsxs)(n.li,{children:["Used ",(0,r.jsx)(n.strong,{children:"within if-else"})," statements"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"use-modifiers-only-for-validations",children:"Use Modifiers Only for Validations"}),"\n",(0,r.jsx)(n.p,{children:"Just do validations within modifiers and avoid external calls on them:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"modifier partnerShare() { // Possibly dangerous\n  partner.transfer(msg.value / 10); \n  _; \n}          \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"modifier onlyOwner() { // Better!\n  require(msg.sender == owner); \n  _; \n}          \n"})}),"\n",(0,r.jsx)(n.h3,{id:"pull-over-push",children:"Pull Over Push"}),"\n",(0,r.jsxs)(n.p,{children:["Prioritize ",(0,r.jsx)(n.em,{children:"receiving"})," contract calls over ",(0,r.jsx)(n.em,{children:"making"})," contract calls:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"function doRefund() external onlyOwner { // Possibly dangerous  \n  uint refund;  \n  for(uint i = 0; i < refunds.length; i++) {      \n    refund = refunds[i].value;      \n    refunds[i].value = 0;      \n    refunds[i].addr.transfer(refund);  \n  }\n}                    \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"function withdrawRefund() external { // Better!  \n  require(refunds[msg.sender] > 0);  \n  uint refund = refunds[msg.sender];  \n  refunds[msg.sender] = 0;  \n  msg.sender.transfer(refund);\n}          \n"})}),"\n",(0,r.jsx)(n.h3,{id:"fallback-functions-and-data-length",children:"Fallback Functions and Data Length"}),"\n",(0,r.jsx)(n.p,{children:"Keep fallback functions simple and check data length:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"fallback() payable external { // Possibly dangerous  \n  balances[msg.sender] += msg.value;\n}            \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"receive() external { // Better!  \n  balances[msg.sender] += msg.value;\n}\n\nfallback() external {  \n  require(msg.data.length == 0);  \n  emit LogDeposit(msg.sender);\n}          \n"})}),"\n",(0,r.jsx)(n.h3,{id:"checks-effects-interactions",children:"Checks-Effects-Interactions"}),"\n",(0,r.jsxs)(n.p,{children:["Avoid state changes after external calls, to avoid things like ",(0,r.jsx)(n.a,{href:"https://solidity.readthedocs.io/en/v0.5.11/security-considerations.html#re-entrancy",children:"the DAO hack:"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'function withdraw(uint amount) public { // Possibly dangerous  \n  require(balances[msg.sender] >= amount);  \n  msg.sender.call{value:amount}("");  \n  balances[msg.sender] -= amount;\n}        \n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'function withdraw(uint amount) public { // Better!  \n  require(balances[msg.sender] >= amount);  \n  balances[msg.sender] -= amount;  \n  msg.sender.call{value:amount}("");\n}        \n'})}),"\n",(0,r.jsxs)(n.h3,{id:"proper-use-of-call-delegatecall-instead-of-send-transfer",children:["Proper use of ",(0,r.jsx)(n.code,{children:"call"}),", ",(0,r.jsx)(n.code,{children:"delegatecall"})," instead of ",(0,r.jsx)(n.code,{children:"send"}),", ",(0,r.jsx)(n.code,{children:"transfer"})]}),"\n",(0,r.jsxs)(n.p,{children:["After the Istanbul hardfork, ",(0,r.jsx)(n.a,{href:"https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/",children:"it's recommended"})," not to use ",(0,r.jsx)(n.code,{children:"send"})," and ",(0,r.jsx)(n.code,{children:"transfer"}),", and instead use ",(0,r.jsx)(n.code,{children:"call.value"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"contract Vulnerable { // Possibly dangerous  \n  function withdraw(uint256 amount) external {      \n    // This forwards 2300 gas, which may not be enough if the recipient      \n    // is a contract and gas costs change.      \n    msg.sender.transfer(amount);  \n  }\n}      \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'contract Fixed { // Better!  \n  function withdraw(uint256 amount) external {      \n    // This forwards all available gas. Be sure to check the return value!      \n    (bool success, ) = msg.sender.call{value:amount}("");      \n    require(success, "Transfer failed.");  \n  }\n}      \n'})}),"\n",(0,r.jsxs)(n.p,{children:["And then proper use of ",(0,r.jsx)(n.code,{children:"call"})," and ",(0,r.jsx)(n.code,{children:"delegatecall"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'addr.call(abi.encodeWithSignature("f(uint)", a));\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Used to call functions and send ether"}),"\n",(0,r.jsx)(n.li,{children:"Allows specify gas"}),"\n",(0,r.jsx)(n.li,{children:"Returns boolean"}),"\n",(0,r.jsx)(n.li,{children:"Does not propagate exceptions"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'addr.delegatecall(abi.encodeWithSignature("f(uint)", a));\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Used to run functions within the caller's context (library feature)"}),"\n",(0,r.jsx)(n.li,{children:"Allows specify gas"}),"\n",(0,r.jsx)(n.li,{children:"Returns boolean"}),"\n",(0,r.jsx)(n.li,{children:"Does not propagate exceptions"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"additional-material",children:"Additional Material"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://consensys.github.io/smart-contract-best-practices/",children:"Wiki: Smart Contract Best Practices (ConsenSys)"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.a,{href:"https://consensys.net/diligence/blog/2019/09/stop-using-soliditys-transfer-now/",children:["Article: Stop Using Solidity's ",(0,r.jsx)(n.code,{children:"transfer"})]})," Article from ConsenSys Diligence"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);